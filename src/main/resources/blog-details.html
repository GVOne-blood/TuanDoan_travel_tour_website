<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Đang tải bài viết...</title>

  <!--====== Favicon Icon ======-->
  <link rel="shortcut icon" href="assets/images/logo/logo-8.png" type="image/png" />

  <!-- ===== All CSS files ===== -->
  <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
  <link rel="stylesheet" href="assets/css/animate.css" />
  <link rel="stylesheet" href="assets/css/lineicons.css" />
  <link rel="stylesheet" href="assets/css/ud-styles.css" />

  <!-- Custom CSS for a more beautiful article page -->
  <style>
    /* Tiêu đề nổi bật với hiệu ứng gradient */
    .ud-blog-details-title {
      font-size: 2.8rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 25px;
      background: linear-gradient(45deg, #3652E1, #8A3CE5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-fill-color: transparent;
    }

    /* Cải thiện khả năng đọc cho nội dung bài viết */
    #article-content-body {
      font-size: 1.1rem;
      line-height: 1.8;
      color: #5a6475;
    }
    #article-content-body p {
      margin-bottom: 1.5rem;
    }
    #article-content-body h3 {
      font-size: 1.8rem;
      font-weight: 600;
      margin-top: 2.5rem;
      margin-bottom: 1.5rem;
      color: #212529;
    }
    #article-content-body blockquote {
      border-left: 4px solid #3652E1;
      padding: 20px 30px;
      background-color: #f4f7ff;
      font-style: italic;
      font-size: 1.2rem;
      margin: 2rem 0;
    }
    #article-content-body ul,
    #article-content-body ol {
      padding-left: 2rem;
      margin-bottom: 1.5rem;
    }

    /* Tinh chỉnh khu vực tác giả */
    .ud-blog-overlay-content .ud-blog-author a {
      color: white;
      font-weight: 600;
    }
    .ud-blog-overlay-content .ud-blog-author a:hover {
      text-decoration: underline;
    }

    /* Cải thiện thẻ bài viết liên quan */
    .ud-related-articles .ud-single-blog {
      text-decoration: none;
      display: block;
      color: inherit;
    }
  </style>
</head>

<body>
<!-- ====== Header Start ====== -->
<div id="header-placeholder"></div>
<!-- ====== Header End ====== -->

<!-- ====== Banner Start ====== -->
<section class="ud-page-banner">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="ud-banner-content">
          <h1 id="banner-title" style="font-family: Arial,serif">Chi Tiết Bài Viết</h1>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- ====== Banner End ====== -->

<!-- ====== Blog Details Start ====== -->
<section class="ud-blog-details">
  <div class="container">
    <div class="row">
      <div class="col-lg-8">
        <!-- Phần nội dung chính sẽ được điền dữ liệu vào đây -->
        <div id="main-article-wrapper">
          <!-- Loading Spinner -->
          <div class="text-center py-5" id="article-loader">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
              <span class="visually-hidden">Đang tải...</span>
            </div>
          </div>
          <!-- Nội dung bài viết sẽ được chèn vào đây bởi JS -->
        </div>
      </div>
      <div class="col-lg-4">
        <!-- Phần sidebar được giữ nguyên hoàn toàn -->
        <div class="ud-blog-sidebar">
          <div class="ud-newsletter-box">
            <img src="assets/images/blog/dotted-shape.svg" alt="shape" class="shape shape-1" />
            <img src="assets/images/blog/dotted-shape.svg" alt="shape" class="shape shape-2" />
            <h3 class="ud-newsletter-title">Đăng ký nhận tin!</h3>
            <p>Nhập email để nhận các bài viết mới nhất.</p>
            <form class="ud-newsletter-form">
              <input type="email" name="email" placeholder="Email của bạn" />
              <button class="ud-main-btn">Đăng ký</button>
            </form>
          </div>
          <div class="ud-articles-box">
            <h3 class="ud-articles-box-title">Bài viết phổ biến</h3>
            <ul class="ud-articles-list">
              <li>
                <div class="ud-article-image"><img src="assets/images/blog/article-author-01.png" alt="author" /></div>
                <div class="ud-article-content">
                  <h5 class="ud-article-title"><a href="javascript:void(0)">Cẩm Nang Du Lịch Sapa Từ A Đến Z</a></h5>
                  <p class="ud-article-author">Admin</p>
                </div>
              </li>
              <li>
                <div class="ud-article-image"><img src="assets/images/blog/article-author-02.png" alt="author" /></div>
                <div class="ud-article-content">
                  <h5 class="ud-article-title"><a href="javascript:void(0)">5 Hòn Đảo Hoang Sơ Đẹp Nhất Việt Nam</a></h5>
                  <p class="ud-article-author">Admin</p>
                </div>
              </li>
              <li>
                <div class="ud-article-image"><img src="assets/images/blog/article-author-03.png" alt="author" /></div>
                <div class="ud-article-content">
                  <h5 class="ud-article-title"><a href="javascript:void(0)">Kinh Nghiệm Xin Visa Schengen</a></h5>
                  <p class="ud-article-author">Admin</p>
                </div>
              </li>
            </ul>
          </div>
          <div class="ud-banner-ad">
            <a href="javascript:void(0)"><img src="assets/images/blog/bannder-ad.png" alt="ad banner" /></a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- ====== Blog Details End ====== -->

<!-- ====== Related Articles Start ====== -->
<section class="ud-blog-grids ud-related-articles" style="display: none;">
  <div class="container">
    <div class="row col-lg-12">
      <div class="ud-related-title">
        <h2 class="ud-related-articles-title">Bài Viết Liên Quan</h2>
      </div>
    </div>
    <div class="row" id="related-articles-grid">
      <!-- Các bài viết liên quan sẽ được render ở đây -->
    </div>
  </div>
</section>
<!-- ====== Related Articles End ====== -->

<!-- ====== Footer Start ====== -->
<div id="footer-placeholder"></div>
<!-- ====== Footer End ====== -->

<a href="javascript:void(0)" class="back-to-top"><i class="lni lni-chevron-up"></i></a>

<!-- ====== All Javascript Files ====== -->
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/wow.min.js"></script>
<script src="assets/js/main.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="assets/js/include.js"></script>

<script>
  $(document).ready(function() {
    const urlParams = new URLSearchParams(window.location.search);
    const articleId = urlParams.get('id');

    if (!articleId) {
      $('#main-article-wrapper').html('<div class="text-center py-5"><h2>Lỗi: Không tìm thấy ID bài viết.</h2></div>');
      return;
    }

    function fetchArticleDetails(id) {
      $.ajax({
        url: `http://localhost:8085/api/tintuc/${id}`,
        type: 'GET',
        success: function(response) {
          if (response && response.status === 200 && response.data) {
            renderArticle(response.data);
            fetchRelatedArticles(id);
          } else {
            $('#main-article-wrapper').html(`<div class="text-center py-5"><h2>Không tìm thấy bài viết.</h2><p>${response.message || ''}</p></div>`);
          }
        },
        error: function() {
          $('#main-article-wrapper').html('<div class="text-center py-5"><h2>Đã xảy ra lỗi khi tải bài viết.</h2></div>');
        }
      });
    }

    function renderArticle(article) {
      document.title = article.tieuDe;
      $('#banner-title').text(article.tieuDe);

      const formattedDate = new Date(article.ngayDang).toLocaleDateString('vi-VN', {
        day: '2-digit', month: 'long', year: 'numeric'
      });
      const authorName = article.tenNguoiDang || 'Tác giả';

      const articleHtml = `
                <div class="ud-blog-details-image">
                    <img src="${article.hinhAnh || 'assets/images/blog/blog-details-01.jpg'}" alt="${article.tieuDe}" />
                    <div class="ud-blog-overlay">
                        <div class="ud-blog-overlay-content">
                            <div class="ud-blog-author">
                                <img src="${article.avatarNguoiDang || 'assets/images/blog/author-01.png'}" alt="author" />
                                <span>Bởi <a href="javascript:void(0)">${authorName}</a></span>
                            </div>
                            <div class="ud-blog-meta">
                                <p class="date"><i class="lni lni-calendar"></i> <span>${formattedDate}</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ud-blog-details-content">
                    <h2 class="ud-blog-details-title">${article.tieuDe}</h2>
                    <div id="article-content-body">${article.noiDung}</div>
                    <div class="ud-blog-details-action">
                        <ul class="ud-blog-tags">
                            <li><a href="javascript:void(0)">Du Lịch</a></li>
                            <li><a href="javascript:void(0)">Kinh Nghiệm</a></li>
                        </ul>
                        <div class="ud-blog-share">
                            <h6>Chia sẻ bài viết</h6>
                            <ul class="ud-blog-share-links">
                                <li><a href="javascript:void(0)" class="facebook"><i class="lni lni-facebook-filled"></i></a></li>
                                <li><a href="javascript:void(0)" class="twitter"><i class="lni lni-twitter-filled"></i></a></li>
                                <li><a href="javascript:void(0)" class="linkedin"><i class="lni lni-linkedin-original"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
      $('#main-article-wrapper').html(articleHtml);
    }

    function fetchRelatedArticles(currentId) {
      $('#related-articles-grid').html('<div class="col-12 text-center py-3"><div class="spinner-border spinner-border-sm text-primary" role="status"></div></div>');

      $.ajax({
        url: 'http://localhost:8085/api/tintuc/getAllPage',
        type: 'GET',
        data: { pageSize: 4, pageIndex: 0 },
        success: function(response) {
          if (response && response.status === 0 && response.data && response.data.content) {
            const relatedArticles = response.data.content.filter(article => article.id != currentId).slice(0, 3);
            renderRelatedArticles(relatedArticles);
          }
        }
      });
    }

    function renderRelatedArticles(articles) {
      const grid = $('#related-articles-grid');
      grid.empty();

      if (articles.length > 0) {
        $('.ud-related-articles').show();
        articles.forEach(article => {
          const formattedDate = new Date(article.ngayDang).toLocaleDateString('vi-VN', { day: '2-digit', month: '2-digit', year: 'numeric' });

          // SỬA LỖI Ở ĐÂY: Bọc toàn bộ card trong thẻ <a>
          const articleHtml = `
                        <div class="col-lg-4 col-md-6">
                            <a href="blog-details.html?id=${article.id}" class="ud-single-blog wow fadeInUp" data-wow-delay=".1s">
                                <div class="ud-blog-image">
                                    <img src="${article.hinhAnh || 'assets/images/blog/blog-01.jpg'}" alt="${article.tieuDe}" />
                                </div>
                                <div class="ud-blog-content">
                                    <span class="ud-blog-date">${formattedDate}</span>
                                    <h3 class="ud-blog-title">${article.tieuDe}</h3>
                                </div>
                            </a>
                        </div>
                    `;
          grid.append(articleHtml);
        });
      }
    }

    fetchArticleDetails(articleId);
  });
</script>
</body>

</html>